var BoxCollection=require("../collections/BoxCollection.js"),TagCollection=require("../collections/TagCollection.js"),ProjectCollection=require("../collections/ProjectCollection.js"),StudentItemView=require("./BoxItemView.js"),ProjectItemView=require("./ProjectItemView.js"),template=require("../../../_hbs/introview.hbs"),IntroView=Backbone.View.extend({template:template,tagName:"div",className:"intro",events:{"click .addButton":"clickAdd","input .filter":"inputFilter","click .list":"gotolist"},array:[],gotolist:function(t){t.preventDefault(),Window.Application.navigate("list",{trigger:!0})},inputFilter:function(t){t.preventDefault();var e=$(t.currentTarget).val().toLowerCase();if(""!==e){this.$el.find(".addbox").hide(),this.$el.find(".box").hide(),this.$el.find(".tag").show(),document.body.style.background="rgba(255,255,255,1)",this.$el.find(".lamp").css("width","20%"),this.$el.find(".lamp").css("margin-top","-167px");var i=e.split(" ");this.renderFilteredTags(this.projectcollection.filterTags(e))}else this.$el.find(".lamp").css("width","40%"),this.$el.find(".lamp").css("margin-top","-365px"),this.$el.find(".addbox").show(),this.$el.find(".tag").hide(),this.array=[],this.projectcollection.fetch()},clickAdd:function(t){t.preventDefault(),Window.Application.navigate("overview",{trigger:!0})},initialize:function(){this.collection=new BoxCollection,this.listenTo(this.collection,"sync",this.renderStudents),this.collection.fetch(),this.projectcollection=new ProjectCollection,this.listenTo(this.projectcollection,"sync",this.renderTags),this.projectcollection.fetch(),$(window).scroll(this.detect_scroll)},onlyUnique:function(t,e,i){return i.indexOf(t)===e},detect_scroll:function(){console.log("detected")},renderStudents:function(){this.$students.empty(),this.collection.forEach(this.renderStudent,this)},renderFilteredStudents:function(t){this.array.push(t[0].attributes.name);for(var e=0;e<this.array.length;e++){this.$students.empty();var i=this.array[e].filter(this.onlyUnique)}},renderStudent:function(t){var e=new StudentItemView({model:t});this.$students.append(e.render().el)},renderTags:function(){this.$tags.empty(),this.projectcollection.forEach(this.renderTag,this)},renderFilteredTags:function(t){for(var e=0;e<t.length;e++)var i=t[e].attributes.box_name;this.$tags.empty(),t.forEach(this.renderTag,this)},renderTag:function(t){var e=new ProjectItemView({model:t});this.$tags.append(e.render().el)},render:function(){return this.$el.html(this.template()),this.$students=this.$el.find(".box"),this.$students.hide(),this.$tags=this.$el.find(".tag"),this.$el.find(".tag").hide(),this.$el.find(".header").addClass="white",this.$el.find(".form").addClass="white",this}});module.exports=IntroView;