var BoxCollection=require("../collections/BoxCollection.js"),TagCollection=require("../collections/TagCollection.js"),ProjectCollection=require("../collections/ProjectCollection.js"),StudentItemView=require("./BoxItemView.js"),ProjectItemView=require("./ProjectItemView.js"),template=require("../../../_hbs/introview.hbs"),IntroView=Backbone.View.extend({template:template,tagName:"div",className:"intro",events:{"click .addButton":"clickAdd","input .filter":"inputFilter","click .home":"goHome"},array:[],goHome:function(e){console.log("go home"),Window.Application.navigate("intro",{trigger:!0}),location.reload()},inputFilter:function(e){e.preventDefault();var t=$(e.currentTarget).val().toLowerCase();if(""!==t){this.$el.find(".addbox").hide(),this.$el.find(".box").hide(),this.$el.find(".tag").show(),document.body.style.background="rgba(255,255,255,1)",this.$el.find(".white").removeClass("white"),this.$el.find(".lamp").attr("src","assets/lamp.svg"),this.$el.find(".addButton").show();var i=t.split(" ");this.renderFilteredTags(this.projectcollection.filterTags(t))}else this.$el.find(".addbox").show(),this.$el.find(".tag").hide(),this.array=[],this.projectcollection.fetch()},clickAdd:function(e){e.preventDefault(),Window.Application.navigate("overview",{trigger:!0})},initialize:function(){this.collection=new BoxCollection,this.listenTo(this.collection,"sync",this.renderStudents),this.collection.fetch(),this.projectcollection=new ProjectCollection,this.listenTo(this.projectcollection,"sync",this.renderTags),this.projectcollection.fetch()},onlyUnique:function(e,t,i){return i.indexOf(e)===t},renderStudents:function(){this.$students.empty(),this.collection.forEach(this.renderStudent,this)},renderFilteredStudents:function(e){this.array.push(e[0].attributes.name);for(var t=0;t<this.array.length;t++){this.$students.empty();var i=this.array[t].filter(this.onlyUnique)}},renderStudent:function(e){var t=new StudentItemView({model:e});this.$students.append(t.render().el)},renderTags:function(){this.$tags.empty(),this.projectcollection.forEach(this.renderTag,this)},renderFilteredTags:function(e){for(var t=0;t<e.length;t++)var i=e[t].attributes.box_name;this.$tags.empty(),e.forEach(this.renderTag,this)},renderTag:function(e){var t=new ProjectItemView({model:e});this.$tags.append(t.render().el)},render:function(){return this.$el.html(this.template()),this.$students=this.$el.find(".box"),this.$students.hide(),this.$tags=this.$el.find(".tag"),this.$el.find(".tag").hide(),this.$el.find(".header").addClass="white",this.$el.find(".form").addClass="white",document.body.style.backgroundImage="url('"+window.settings.httpRoot+"assets/bg_image1.jpg')",document.body.style.backgroundColor="rgba(110, 59, 59, 0) ",document.body.style.backgroundRepeat="no-repeat",document.body.style.backgroundSize="cover",this.$el.find(".addButton").hide(),this}});module.exports=IntroView;