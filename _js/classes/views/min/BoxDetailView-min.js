var template=require("../../../_hbs/student_detail.hbs"),Box=require("../models/Box.js"),TagCollection=require("../collections/TagCollection.js"),ProjectCollection=require("../collections/ProjectCollection.js"),TagItemView=require("../views/TagItemView.js"),ProjectItemView=require("../views/ProjectItemView.js"),BoxDetailView=Backbone.View.extend({template:template,tagName:"section",className:"dozen",events:{"click .delete":"clickDelete","click .addproject":"clickAddproject","click .home":"goHome","click .over":"goOverview"},array:[],booleancheck:!1,goHome:function(e){Window.Application.navigate("intro",{trigger:!0})},goOverview:function(e){e.preventDefault(),Window.Application.navigate("overview",{trigger:!0})},clickAddproject:function(e){if(e.preventDefault(),""!==this.$el.find(".textproject").val()){var t=this.project;this.project.create({name:this.$el.find(".textproject").val(),box_id:this.model.get("id"),box_name:this.model.get("name"),tags_list:this.$el.find(".textproject").val()},{success:function(e){var i=t.models[t.models.length-1];$.map(i.attributes,function(e,t){});var n=t.models[t.models.length-1].id;Window.Application.navigate("projects/"+n,{trigger:!0})}}),this.$el.find(".textproject").val("")}},clickDelete:function(e){e.preventDefault(),document.getElementById("popup").className="";var t=document.getElementById("popup"),i=this.model;t.getElementsByClassName("go")[0].addEventListener("click",function(e){e.preventDefault(),i.destroy(),$.ajax({type:"DELETE",url:window.settings.httpRoot+"api/projects/box/"+i.get("id"),success:function(e){}}),$.ajax({type:"DELETE",url:window.settings.httpRoot+"api/tags/box/"+i.get("id"),success:function(e){}}),document.getElementById("popup").className="hidden",location.reload()}),t.getElementsByClassName("no")[0].addEventListener("click",function(e){e.preventDefault(),document.getElementById("popup").className="hidden"})},initialize:function(e){e&&e.id&&(this.model=new Box,this.model.on("destroy",function(){Window.Application.navigate("overview",{trigger:!0})}),this.model.set("id",e.id),this.model.fetch({success:function(e,t){0===t.length&&Window.Application.navigate("overview",{trigger:!0})}}),this.listenTo(this.model,"sync",this.render),this.tag=new TagCollection({box_id:e.id}),this.tag.on("sync",this.renderAllTags,this),this.project=new ProjectCollection({box_id:e.id}),this.project.on("sync",this.renderAllProjects,this))},renderAllTags:function(){this.$tag.empty(),this.tag.forEach(this.renderTag,this)},renderTag:function(e){this.$tag.append(new TagItemView({model:e}).render().el)},renderAllProjects:function(){this.$project.empty(),this.project.forEach(this.renderProject,this)},renderProject:function(e){this.$project.append(new ProjectItemView({model:e}).render().el)},render:function(){return this.$el.html(this.template(this.model.attributes)),this.$tag=this.$el.find(".tagresults"),this.$project=this.$el.find(".results"),this.tag.fetch(),this.project.fetch(),this}},{levenshtein_distance_a:function(e,t){if(0==e.length)return t.length;if(0==t.length)return e.length;var i=[],n;for(n=0;n<=t.length;n++)i[n]=[n];var o;for(o=0;o<=e.length;o++)i[0][o]=o;for(n=1;n<=t.length;n++)for(o=1;o<=e.length;o++)t.charAt(n-1)==e.charAt(o-1)?i[n][o]=i[n-1][o-1]:i[n][o]=Math.min(i[n-1][o-1]+1,Math.min(i[n][o-1]+1,i[n-1][o]+1));return i[t.length][e.length]}});module.exports=BoxDetailView;